### [2023-12-02 15:30] 修復路由配置架構問題
**里程碑/事件類型**：問題修正、架構優化  
**內容摘要**：
- 事件描述：發現並修復了 Facebook Webhook 無法返回訊息的問題
- 原因與背景：原先的路由設計將所有路由掛載到同一個 Router 實例，導致路由混亂
- 對後續影響：優化後的路由架構更清晰，各 API 路徑可獨立運作，降低維護難度
- 關聯紀錄：
  - 對話紀錄：2023-12-02「Facebook Webhook 無法返回訊息問題排查」
  - 程式碼更新：2023-12-02「修復 Facebook Webhook 路由配置問題」
  
### [2023-12-02 16:45] 修復 Facebook Webhook 處理的變量錯誤
**里程碑/事件類型**：問題修正、錯誤處理  
**內容摘要**：
- 事件描述：修復 Facebook Webhook 處理消息時的 useTestMode 未定義錯誤
- 原因與背景：對話處理函數中 options 參數解構被註釋掉，導致變量引用錯誤
- 對後續影響：提高系統穩定性，確保 Facebook 消息能被正確處理並存儲
- 關聯紀錄：
  - 對話紀錄：2023-12-02「修復 useTestMode 未定義錯誤」
  - 程式碼更新：2023-12-02「修復 useTestMode 未定義錯誤」
  
### [2023-12-03 14:00] 增強向量資料庫錯誤處理機制
**里程碑/事件類型**：系統穩定性、錯誤處理  
**內容摘要**：
- 事件描述：增強 Pinecone 向量資料庫互動的錯誤處理和防呆機制
- 原因與背景：系統在 Pinecone API 回傳非預期內容時容易崩潰，特別是 JSON 解析錯誤
- 對後續影響：
  - 提高系統整體穩定性，減少因外部服務問題導致的系統中斷
  - 更容易診斷和排查 Pinecone 相關的問題
  - 為未來系統擴展提供更穩固的基礎
- 關聯紀錄：
  - 對話紀錄：2023-12-03「Pinecone API 回應解析錯誤排查」
  - 程式碼更新：2023-12-03「增強向量資料庫處理的錯誤防呆機制」

### [2023-08-14 12:20] 修復 Facebook Webhook 控制器啟動問題
**里程碑/事件類型**：問題修正  
**內容摘要**：
- 事件描述：修復 Facebook Webhook 控制器無法啟動的問題，原因是 logger 模組引用路徑錯誤
- 原因與背景：系統啟動時報錯「Cannot find module '../utils/logger/logger'」，經確認 utils 目錄下只有 logger 目錄而非 logger/logger.js 文件
- 對後續影響：
  - 確保 Webhook 相關功能能夠正常運行
  - 提高系統穩定性和日誌記錄功能的可靠性
  - 為後續整合智能訊息合併功能打下基礎
- 關聯紀錄：
  - 對話紀錄：2023-08-14「Facebook Webhook 控制器啟動問題修復」
  - 程式碼更新：2023-08-14「修復 Facebook Webhook 控制器的 logger 模組引用」

### [2023-08-15 11:00] 優化客服系統架構：實現意圖分類與回應分離
**里程碑/事件類型**：架構優化、功能增強
**內容摘要**：
- 事件描述：將 AI 回應處理流程從單一步驟改為「分類-回應」二步驟設計
- 原因與背景：
  - 原來的方式直接生成回應，難以確保回應的一致性和準確性
  - 客服常見問題有明確分類，適合先識別用戶意圖再給予固定回應
  - 需要提升系統穩定性和回應質量
- 對後續影響：
  - 提高客服回應的準確性和一致性
  - 簡化後續流程處理，便於添加新的問答模板
  - 降低 AI 生成不當回應的風險
  - 為未來實現更複雜的多輪對話奠定基礎
- 關聯紀錄：
  - 對話紀錄：2023-08-15「將 AI 回應處理器調整為訊息分類器」
  - 程式碼更新：2023-08-15「調整 AI 回應處理器為分類器功能」

### [2023-08-16 16:00] AI 回應處理器重構與最佳實踐應用
**里程碑/事件類型**：代碼重構  
**內容摘要**：
- 事件描述：對 AI 回應處理器進行全面重構，提升代碼品質與可靠性
- 原因與背景：
  - 日誌中發現 LangChain 將 JSON 格式範例誤解為變數的錯誤
  - 原有重試和錯誤處理邏輯過於複雜且缺乏結構
  - 需要更好的日誌記錄以便診斷 AI 回應相關問題
  
- 對後續影響：
  - 提高了系統的穩定性和錯誤恢復能力
  - 降低了代碼維護難度，便於團隊協作開發
  - 建立了更清晰的回應處理模式，可作為其他子模塊的參考
  - 更完善的日誌記錄有助於診斷問題
  
- 關聯紀錄：
  - 對話紀錄：2023-08-16「優化 AI 回應處理器：解決變數引用錯誤並重構代碼」
  - 程式碼更新：2023-08-16「重構 AI 回應處理器：提取重試邏輯至獨立函數」 

### [2023-08-16 18:00] 完成客服系統「分類-回應」二階段流程實現
**里程碑/事件類型**：功能完善、系統整合  
**內容摘要**：
- 事件描述：完成了完整的「AI 分類 + 預設答案庫」客服回應流程
- 原因與背景：
  - 單純使用 AI 生成回應缺乏一致性，不適合客服場景
  - 預設答案更容易維護和審核，確保回應品質
  - 需要整合 AI 智能分類能力與人工編寫的高質量答案
  - 實現自動化的端到端流程，減少人工處理環節
  
- 對後續影響：
  - 大幅提升客服回應的一致性和準確性
  - 通過 MongoDB 中心化管理答案庫，便於內容更新
  - 降低了 AI 生成不適當內容的風險
  - 為後續添加更多智能功能奠定基礎
  - 系統架構更加清晰，各模塊職責分明
  
- 關聯紀錄：
  - 對話紀錄：2023-08-16「完善客服系統：根據 AI 分類結果自動獲取預設答案」
  - 程式碼更新：2023-08-16「增強 AI 回應處理器：添加從 MongoDB 獲取答案的功能」 