### [2023-12-02 15:30] 修復 Facebook Webhook 路由配置問題

**提交人**：我  
**更新摘要**：
- 修改檔案：`routes/index.js`, `server.js`, `utils/aiResponseHandler.js`
- 主要變更內容：
  - 修復路由器混合錯誤，將所有路由分別獨立導出
  - 修改 server.js 中的路由掛載路徑，確保 webhook 掛載到正確路徑
  - 修正 aiResponseHandler.js 中 useTestMode 參數設置問題
- 相關 Issue 或對話連結：對話關於「facebook.webhook 那邊不會返回訊息」問題
- 是否通過測試：初步測試通過
- 備註：Facebook Webhook 路由現在掛載在 /webhook 路徑下

**變更前後差異說明**：
- 前版本：所有路由共享同一個 Router 實例，導致路由混亂
- 後版本：各路由分開處理，apiRoutes、logRoutes 和 webhookRoutes 分別掛載到不同路徑

### [2023-12-02 16:45] 修復 useTestMode 未定義錯誤

**提交人**：我  
**更新摘要**：
- 修改檔案：`utils/conversationHandler.js`
- 主要變更內容：
  - 修正 processAndStoreConversation 函數中的選項參數解構
  - 取消註解從 options 中解構 useTestMode 和 syncProcess 參數的代碼
  - 確保在整個函數中能正確使用這些參數
- 相關 Issue 或對話連結：Facebook webhook 處理時出現 "ReferenceError: useTestMode is not defined" 錯誤
- 是否通過測試：待測試
- 備註：修復後應能正確處理 Facebook 發送的訊息並存儲到 MongoDB 和向量資料庫

**變更前後差異說明**：
- 前版本：未從 options 參數中解構 useTestMode，導致後續使用時出現未定義錯誤
- 後版本：正確解構 options 參數，確保 useTestMode 在需要時可用

### [2023-12-02 16:30] 修正 Facebook Webhook 路由路徑

**提交人**：我  
**更新摘要**：
- 修改檔案：`server.js`
- 主要變更內容：
  - 將 webhookRoutes 路由掛載從 `/api/facebook_bot` 改為根路徑 `/`
  - 確保 `/webhook` 端點能被正確處理
- 相關 Issue 或對話連結：Facebook webhook 無法返回訊息問題
- 是否通過測試：待測試
- 備註：Facebook 對 webhook 的路徑有嚴格要求，需確保路徑正確

**變更前後差異說明**：
- 前版本：webhook 路由掛載在 `/api/facebook_bot/webhook`
- 後版本：webhook 路由掛載在 `/webhook` 

### [2023-12-03 14:00] 增強向量資料庫處理的錯誤防呆機制

**提交人**：我  
**更新摘要**：
- 修改檔案：`utils/vectorStoreHandler.js`, `utils/conversationHandler.js`
- 主要變更內容：
  - 增強 `fetchExistingFaqs` 函數，添加多層防呆處理，避免 JSON 解析錯誤
  - 優化 `storeConversationToVectorDB` 函數，增加對象有效性檢查和更完善的錯誤處理
  - 改善日誌記錄，捕獲更多可能的錯誤情境
  - 解決 Pinecone API 回應為空或非預期格式時的處理
- 相關 Issue 或對話連結：討論關於 "Unexpected end of JSON input" 錯誤的解決方案
- 是否通過測試：初步測試通過
- 備註：重點是解決 Pinecone 互動時的穩定性問題，避免因資料庫回應異常導致整個程序崩潰

**變更前後差異說明**：
- 前版本：當 Pinecone 回應異常時，程式會直接拋出錯誤並中斷流程
- 後版本：程式能優雅處理各種異常情況，對空響應或格式錯誤有專門處理邏輯，確保核心功能不受影響 